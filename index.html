<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Bifrozt-ansible by Bifrozt</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Bifrozt-ansible</h1>
        <h2>Deploy Bifrozt using Ansible</h2>

        <section id="downloads">
          <a href="https://github.com/Bifrozt/bifrozt-ansible/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/Bifrozt/bifrozt-ansible/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/Bifrozt/bifrozt-ansible" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <hr>

<p>This document will </p>

<ul>
<li>Provide an overview of what the Bifrozt deployment should look like</li>
<li>Define its requirements</li>
<li>Explain the installation</li>
<li>Provide instructions on how to verify that it's working correctly</li>
</ul>

<p>Any topic <strong>not</strong> covered within these sections are beyond the scope of the developer.
Everything else is left as an exercise to the end user.
Examples of such topics are but not limited to:</p>

<ul>
<li>Configuration of virtual networking within various hypervisors</li>
<li>Issues that are the result of the end user changing the configuration files</li>
<li>Writing parts of a thesis or school project (really???)</li>
<li>Problems not related to SSH communication with the honeypot and/or the Bifrozt firewall</li>
</ul>

<hr>

<h4>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Overview.</strong>
</h4>

<p>Generally speaking, Bifrozt is a NAT device with a DHCP server that is usually deployed with one NIC (eth0) connected directly to the Internet and one NIC (eth1) connected to the internal network.<br></p>

<p><img src="https://www.honeynet.org/sites/default/files/images/deploy_example.png" alt="Example deployment"></p>

<p>What differentiates Bifrozt from other standard NAT devices is its ability to work as a transparent SSHv2 proxy between an attacker and your honeypot. The software that's being used as a SSHv2 proxy is called <a href="https://github.com/tnich/honssh">HonSSH</a> and has been developed by Thomas Nicholson.
<br><br>
If you deployed a SSH server on Bifrozt's internal network it would log all the interaction to a TTY file in plain text that could be viewed later and capture a copy of any files that were downloaded. You do not have to install any additional software, compile any kernel modules or use a specific version or type of operating system on the internal SSH server for this to work
<br><br>
To prevent the attackers from using the honeypot to attack other systems it will limit outbound traffic to a set number of ports, number of connections and the amount of packets being sent, if the firewall finds that any of these limits are exceeded it will start to drop the connections and/or packets sent.</p>

<hr>

<h4>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Requirements.</strong>
</h4>

<h5>
<a id="hardware" class="anchor" href="#hardware" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Hardware.</strong>
</h5>

<p>Minimum hardware requirements (recommended within parenthesis).</p>

<p>Bifrozt</p>

<ul>
<li>2x network interface cards</li>
<li>1 GB RAM (2 GB or more recommended)</li>
<li>10 GB Hard drive (20 GB or more recommended)</li>
<li>1 CPU (2 or more recommended)</li>
</ul>

<p>Honeypot</p>

<ul>
<li>The hardware requirements should reflect the type of server thats being offered.</li>
</ul>

<h5>
<a id="software" class="anchor" href="#software" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Software.</strong>
</h5>

<p>Bifrozt</p>

<ul>
<li>Running Ubuntu 14.04 or later (server version recommended but, works with Desktop version as well).</li>
<li>OpenSSH server (will be added automatically if using local installation method)</li>
</ul>

<p>Honeypot</p>

<ul>
<li>OpenSSH server</li>
</ul>

<hr>

<h4>
<a id="installation-options" class="anchor" href="#installation-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Installation options.</strong>
</h4>

<p>There are mainly two ways of installing the components that turns a system into a honeypot router (aka. Bifrozt)</p>

<ul>
<li>
<strong>Install locally using Ansible.</strong><br>  If you only plan in using a single instance of Bifrozt (which is the most common way of doing it) you should install it locally.</li>
<li>
<strong>Install from a Ansible control machine.</strong><br>  If you have a large infrastructure, plan on deploying Bifrozt to multiple nodes or already have a Ansible control machine installed its only natural to deploy Bifrozt from that.</li>
</ul>

<p>If you already are using Ansible and have a control machine I assume that you are able to deploy without any further instructions. 
<br></p>

<h5>
<a id="install-locally-using-ansible" class="anchor" href="#install-locally-using-ansible" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Install locally using Ansible.</strong>
</h5>

<p>This is the most common way of deploying Bifrozt but, can also be a bit tricky if you never used Ansible before, so i've created a bash script that does most of the tasks for you.<br>
Even tho i've created this script i'd like you to be aware of what this script is doing, this will help you troubleshoot any potential issues with it and give a better understanding of the process.
<br><br>
When executed it will preform three checks that <strong>must</strong> be passed</p>

<ul>
<li>The executing user is <em>root</em>.</li>
<li>The operating system is <em>Ubuntu</em>.</li>
<li>The system has two network interface cards (not counting local interface) and both starts with <em>eth</em>.</li>
</ul>

<p>To run the playbook locally on the machine you would like to use as Bifrozt, execute the following commands<br>
<code>wget https://raw.githubusercontent.com/Bifrozt/bifrozt-ansible/master/bifrozt_setup.sh</code><br></p>

<p>This will download the <code>bifrozt_setup.sh</code>, to run it you have to find the MAC address of your honeypot. The MAC address must be given as an argument to the script as shown in the example below.</p>

<p><code>sudo bash bifrozt_setup.sh 00:11:22:33:44:55</code><br>
<br></p>

<p>When the script completes you will see a post setup summary, similar to this:<br></p>

<pre><code>=================================================

Post setup actions:
    1) If the honeypot is running, power it off now.
    2) Reboot this machine.
    3) Reconnect: ssh -l [name of user] 10.109.133.14 -p 59051 
    4) Start the honeypot.
    5) Start HonSSH: sudo honsshctrl start.

=================================================
</code></pre>

<p>Make sure to take note of what port number has been chosen for SSH administration,<br>
this displayed in <strong>3)</strong>. In this case the SSH server has been configured to run on port <strong>59051</strong>.<br>
What should be mentioned is that, when starting HonSSH, it will start to tail its application log. This is only for convenience, pressing CTRL + C will stop <code>honsshctrl</code> from tailing the log but, it will <strong>not</strong> stop HonSSH.   </p>

<hr>

<p>Example of what the <code>bifrozt_setup.sh</code> script will look like.<br></p>

<pre><code>========= bifrozt_setup.sh - 0.0.7 - 2016-02-24 - Are Hansen =========


2016-03-18 19:46:37 - [OKAY]: Are we root?...Yes 
2016-03-18 19:46:37 - [OKAY]: Are we running Ubuntu?...Yes 
2016-03-18 19:46:37 - [OKAY]: Do we have two network interface cards?...Yes 
2016-03-18 19:46:37 - [TASK]: Installing all avalible system updates... 
2016-03-18 19:49:10 - [OKAY]: All avalible system updates have been installed. 
2016-03-18 19:49:11 - [TASK]: Installing base dependencies... 
2016-03-18 19:49:11 - [OKAY]: Base dependencies has been installed. 
2016-03-18 19:49:11 - [TASK]: Adding Ansible PPA...  
2016-03-18 19:49:12 - [OKAY]: Ansible PPA has been added. 
2016-03-18 19:49:12 - [TASK]: Installing Ansible...  
2016-03-18 19:49:30 - [OKAY]: Ansible has been installed. 
2016-03-18 19:49:30 - [TASK]: Configuring Ansible... 
2016-03-18 19:49:30 - [OKAY]: Ansible has been configured. 
2016-03-18 19:49:30 - [TASK]: Cloning master branch of Bifrozt into /tmp/bifrozt-ansible... 
2016-03-18 19:49:32 - [OKAY]: The master branch of Bifrozt has been cloned into /tmp/bifrozt-ansible. 
2016-03-18 19:49:32 - [TASK]: Setting up Ansible SSH keys... 
2016-03-18 19:49:32 - [OKAY]: Generation of Ansible SSH keys completed. 
2016-03-18 19:49:32 - [TASK]: Setting up authentication key for root user (will be removed later)... 
2016-03-18 19:49:32 - [OKAY]: Authentication key for root has been created. 
2016-03-18 19:49:32 - [TASK]: Executing the playbook now... 
2016-03-18 19:51:05 - [OKAY]: Playbook exited with: 0 
2016-03-18 19:51:05 - [TASK]: Generating IPv4 address of the honeypot... 
2016-03-18 19:51:05 - [OKAY]: IPv4 address for the honeypot has been created. 
2016-03-18 19:51:05 - [TASK]: Updating the MAC address of the honeypot... 
2016-03-18 19:51:05 - [OKAY]: MAC address of the honeypot has been updated. 
2016-03-18 19:51:05 - [TASK]: Generating new DHCP network... 
2016-03-18 19:51:05 - [OKAY]: Network for the DHCP server has been created. 
2016-03-18 19:51:05 - [INFO]: DHCP will be using this network: 192.168.249.0/24 
2016-03-18 19:51:05 - [INFO]: The honeypot will be assigned this IPv4 address: 192.168.249.243 
2016-03-18 19:51:05 - [TASK]: Updating configuration for interface eth1... 
2016-03-18 19:51:05 - [OKAY]: Configuration for eth1 has been updated. 
2016-03-18 19:51:05 - [TASK]: Restarting the eth1 interface... 
2016-03-18 19:51:05 - [OKAY]: Restart of interface eth1 completed. 
2016-03-18 19:51:05 - [TASK]: IPv4 address of eth1: 192.168.249.1 
2016-03-18 19:51:05 - [TASK]: Restarting DHCP server... 
2016-03-18 19:51:05 - [OKAY]: DHCP server has been restarted. 
2016-03-18 19:51:05 - [TASK]: Updating honssh.cfg.default... 
2016-03-18 19:51:05 - [OKAY]: Update of honssh.cfg.default completed. 
2016-03-18 19:51:05 - [TASK]: Making active configuration file, honssh.cfg, from honssh.cfg.default... 
2016-03-18 19:51:05 - [OKAY]: Creation of active configuration file completed. 
2016-03-18 19:51:05 - [TASK]: Selecting a new SSH port for Bifrozt administration... 
2016-03-18 19:51:05 - [TASK]: Updating sshd_config... 
2016-03-18 19:51:05 - [OKAY]: /etc/ssh/sshd_config has been updated. 
2016-03-18 19:51:05 - [TASK]: Updating firewall rules... 
2016-03-18 19:51:05 - [OKAY]: Firewall rules has been updated. 
2016-03-18 19:51:05 - [TASK]: Restarting SSH server... 
2016-03-18 19:51:05 - [OKAY]: SSH server was restarted. 
2016-03-18 19:51:05 - [INFO]: The SSH server is now running on TCP port: 59051 
2016-03-18 19:51:05 - [TASK]: Applying new firewall rules... 
2016-03-18 19:51:05 - [OKAY]: The new firewall rules was applied. 
2016-03-18 19:51:05 - [TASK]: Removing existing "bifrozt-ansible" repo. 
2016-03-18 19:51:05 - [OKAY]: Existing repo was removed. 
2016-03-18 19:51:05 - [TASK]: Removing Ansible SSH keys... 
2016-03-18 19:51:05 - [OKAY]: Ansible SSH keys was removed. 
2016-03-18 19:51:05 - [TASK]: Removing Ansible from the system... 
2016-03-18 19:51:07 - [OKAY]: Ansible was removed from the system. 
2016-03-18 19:51:07 - [TASK]: Removing Ansible PPA... 
2016-03-18 19:51:08 - [OKAY]: Ansible PPA was removed from the system. 
2016-03-18 19:51:08 - [OKAY]: Post-execution clean up completed. 
2016-03-18 19:51:08 - [OKAY]: Setup completed. 


=================================================

Post setup actions:
    1) If the honeypot is running, power it off now.
    2) Reboot this machine.
    3) Reconnect: ssh -l [name of user] 10.109.133.14 -p 59051 
    4) Start the honeypot.
    5) Start HonSSH: sudo honsshctrl start.

=================================================

</code></pre>

<hr>
      </section>
    </div>

    
  </body>
</html>
